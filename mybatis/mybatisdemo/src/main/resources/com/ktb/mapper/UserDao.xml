<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktb.mapper.UserDao">

    <!--一对多映射-->
    <resultMap id="userMap" type="com.ktb.model.User">
        <id property="id" column="id"/>
        <result property="username" column="username"/>
        <result property="age" column="age"/>
        <result property="address" column="address"/>
    </resultMap>

    <resultMap id="roleMap" type="com.ktb.model.Role">
        <id property="id" column="id"/>
        <result property="name" column="name"/>
        <result property="desc" column="desc"/>
    </resultMap>


    <insert id="insertUser">
        insert into users (username, age, address)
        values (#{username}, #{age}, #{address});
    </insert>

    <update id="updateUser">
        update users
        set username=#{username},
            age=#{age},
            address=#{address}
        where id = #{id};
    </update>

    <delete id="deleteById">
        delete
        from users
        where id = #{id};
    </delete>


    <select id="findAll" resultType="com.ktb.model.User">
        SELECT *
        FROM users
    </select>

    <select id="findById" resultMap="roleMap">
        SELECT  roles.id as rid, roles.name, roles.desc
        FROM `user_roles`
                 INNER JOIN `roles` ON `roles`.`id` = `user_roles`.`role_id`
        WHERE `user_roles`.`user_id` = #{id};
    </select>


    <select id="findUser" resultType="com.ktb.model.User">
        SELECT *
        FROM users
        <trim prefix="where" prefixOverrides="and|or">
            <if test="age!=null">
                and age = #{age}
            </if>
            <if test="username!=null">
                and username = #{username}
            </if>
        </trim>
    </select>


    <!--    这样可读性不强-->
    <select id="findbyCondition" resultType="com.ktb.model.User">
        SELECT *
        FROM users
        <trim prefix="where" prefixOverrides="and|or">
            <if test="age!=null">
                and age = #{age}
            </if>
            <if test="username!=null">
                and username = #{username}
            </if>
        </trim>
    </select>


    <select id="findbyConditionTwo" resultType="com.ktb.model.User">
        # SELECT *
        # FROM user
        # WHERE username = #{username}
        # AND age = #{age}
        <!--        <trim prefixOverrides="and">-->
        <!--            and-->
        <!--        </trim>-->
        <!--        <trim suffixOverrides="like|and" >-->
        <!--            and  1=1 like-->
        <!--        </trim>-->


        select * from users
        <trim prefix="where">
            1 = 1;
        </trim>

    </select>



    <select id="findbyConditionThree" resultType="com.ktb.model.User">
        select * from users
        <trim prefix="where">
            1 = 1;
        </trim>
    </select>

</mapper>
