<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.ktb.newbee.dao.IndexConfigDao">

    <resultMap type="com.ktb.newbee.entity.IndexConfig" id="IndexConfigMap">
        <result property="configId" column="config_id" jdbcType="INTEGER"/>
        <result property="configName" column="config_name" jdbcType="VARCHAR"/>
        <result property="configType" column="config_type" jdbcType="INTEGER"/>
        <result property="goodsId" column="goods_id" jdbcType="INTEGER"/>
        <result property="redirectUrl" column="redirect_url" jdbcType="VARCHAR"/>
        <result property="configRank" column="config_rank" jdbcType="INTEGER"/>
        <result property="isDeleted" column="is_deleted" jdbcType="INTEGER"/>
        <result property="createTime" column="create_time" jdbcType="TIMESTAMP"/>
        <result property="createUser" column="create_user" jdbcType="INTEGER"/>
        <result property="updateTime" column="update_time" jdbcType="TIMESTAMP"/>
        <result property="updateUser" column="update_user" jdbcType="INTEGER"/>
    </resultMap>

    <resultMap id="orderUserMapUseAssociation" type="com.ktb.newbee.entity.IndexConfig" autoMapping="false"
               extends="IndexConfigMap">
        <association property="goodsInfo" javaType="com.ktb.newbee.entity.GoodsInfo">
            <id property="goodsId" column="goods_id"></id>
            <result property="goodsName" column="goods_name"></result>
            <result property="sellingPrice" column="selling_price"></result>
        </association>
    </resultMap>


    <!--查询单个-->
    <select id="queryById" resultMap="IndexConfigMap">
        select config_id,
               config_name,
               config_type,
               goods_id,
               redirect_url,
               config_rank,
               is_deleted,
               create_time,
               create_user,
               update_time,
               update_user
        from tb_newbee_mall_index_config
        where config_id = #{configId}
    </select>

    <!--查询所有-->
    <select id="getIndexConfigs" resultMap="orderUserMapUseAssociation">
        SELECT `tb_newbee_mall_index_config`.*,
               `tb_newbee_mall_goods_info`.`goods_id`,
               `tb_newbee_mall_goods_info`.`goods_name`,
               `tb_newbee_mall_goods_info`.`selling_price`
        FROM `tb_newbee_mall_index_config`
                 INNER JOIN `tb_newbee_mall_goods_info` ON `tb_newbee_mall_goods_info`.`goods_id` =
                                                           `tb_newbee_mall_index_config`.`goods_id`
        where config_type = #{configType}
          and is_deleted = 0 limit 5

    </select>


</mapper>

